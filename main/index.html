<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Manual Entry Calculator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f4f4f4;
    }

    .container {
      max-width: 500px;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    input,
    select,
    button {
      width: 100%;
      padding: 10px;
      margin: 5px 0;
    }

    button {
      background-color: #007bff;
      color: white;
      border: none;
      cursor: pointer;
    }

    button:hover {
      background-color: #0056b3;
    }

    .log-output {
      margin-top: 20px;
      padding: 10px;
      background: white;
      border-radius: 5px;
      white-space: pre-line;
      font-family: monospace;
    }
  </style>
</head>

<body>
  <div class="container">
    <h2>Калькулятор мануального ввода</h2>

    <label>Last Event Time (Today) - Enter Manually</label>
    <input type="datetime-local" id="lastEventTime" onchange="calculateTimes()">

    <label>Step 6: Other Work (доезд до грузовика) - Duration (hh:mm)</label>
    <input type="text" id="truckDuration" placeholder="e.g. 5:30" oninput="calculateTimes()">
    <input type="datetime-local" id="truckEnd" disabled>

    <label>Step 5: Start Country (начало страны) - Duration (hh:mm)</label>
    <input type="text" id="startCountryDuration" placeholder="e.g. 0:05" oninput="calculateTimes()">
    <input type="datetime-local" id="startCountryTime" disabled>

    <label>Step 4: Rest (пауза) - Duration (hh:mm)</label>
    <input type="text" id="restDuration" placeholder="e.g. 9:00" oninput="calculateTimes()">
    <input type="datetime-local" id="restEnd" disabled>

    <label>Step 3: End Country (конец страны) - Duration (hh:mm)</label>
    <input type="text" id="endCountryDuration" placeholder="e.g. 0:05" oninput="calculateTimes()">
    <input type="datetime-local" id="endCountryTime" disabled>

    <label>Step 2: Other Work (доезд до базы) - Duration (hh:mm)</label>
    <input type="text" id="workDuration" placeholder="e.g. 2:30" oninput="calculateTimes()">
    <input type="datetime-local" id="workEnd" disabled>

    <label>Step 1: First Event (Manually Entered)</label>
    <input type="datetime-local" id="workStart">

    <button onclick="saveEntry()">Save Entry</button>

    <h3>Generated Log</h3>
    <div class="log-output" id="logOutput"></div>
  </div>

  <script>
    function calculateTimes() {
      let lastEventTime = document.getElementById("lastEventTime").value;
      if (!lastEventTime) return;

      lastEventTime = new Date(lastEventTime);

      function subtractDuration(id, durationId) {
        const duration = document.getElementById(durationId).value;
        if (!duration) return null;

        const [hours, minutes] = duration.split(":").map(Number);
        lastEventTime.setHours(lastEventTime.getHours() - hours);
        lastEventTime.setMinutes(lastEventTime.getMinutes() - minutes);

        const formattedDate = lastEventTime.toISOString().slice(0, 16);
        document.getElementById(id).value = formattedDate;
        return lastEventTime;
      }

      subtractDuration("truckEnd", "truckDuration");
      subtractDuration("startCountryTime", "startCountryDuration");
      subtractDuration("restEnd", "restDuration");
      subtractDuration("endCountryTime", "endCountryDuration");
      subtractDuration("workEnd", "workDuration");
    }

    function saveEntry() {
      const entries = [
        { time: document.getElementById("lastEventTime").value, text: "Вставил карту в тахограф - начало страны" },
        { time: document.getElementById("truckEnd").value, text: "Доезд от базы до грузовика" },
        { time: document.getElementById("startCountryTime").value, text: "Начало страны PL" },
        { time: document.getElementById("restEnd").value, text: "Отдых" },
        { time: document.getElementById("endCountryTime").value, text: "Конец страны PL" },
        { time: document.getElementById("workEnd").value, text: "Доезд от грузовика до базы" },
        { time: document.getElementById("workStart").value, text: "Изъял карту из тахографа" },
      ];

      // Sort in chronological order (earliest first)
      entries.sort((a, b) => new Date(a.time) - new Date(b.time));

      // Format output
      let output = "";
      entries.forEach(entry => {
        if (entry.time) {
          const date = new Date(entry.time);
          output += `${date.toLocaleDateString()} ${date.toLocaleTimeString()}  ${entry.text}\n`;
        }
      });

      document.getElementById("logOutput").innerText = output;
    }
  </script>
</body>

</html>